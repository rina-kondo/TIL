## EC2 インスタンス
### インスタンスファミリー
EC2では、インスタンスの利用目的に合わせて、数種類のハードウェアが用意されています。これを「インスタンスファミリー」といいます。

- #### 汎用
	バランスの取れたコンピューティング、メモリ、ネットワークのリソースを提供し、多様なワークロードに使用できます。汎用インスタンスは、ウェブサーバーやコードリポジトリなど、インスタンスのリソースを同じ割合で使用するアプリケーションに最適です。一般用途向け。

- #### コンピューティング最適化
	高パフォーマンスプロセッサの恩恵を受けるコンピューティングバウンドなアプリケーションに最適です。 このカテゴリに属するインスタンスは、バッチ処理ワークロード、メディアトランスコーディング、ハイパフォーマンスウェブサーバー、ハイパフォーマンスコンピューティング (HPC)、科学モデリング、専用ゲームサーバーおよび広告サーバーエンジン、機械学習推論、および他のコンピューティングを多用するアプリケーションに最適です。

- #### メモリ最適化
	メモリ最適化インスタンスは、メモリ内の大きいデータセットを処理するワークロードに対して高速なパフォーマンスを実現するように設計されています。

- #### 高速コンピューティング
	高速コンピューティングインスタンスでは、ハードウェアアクセラレーター (コプロセッサ) を使用して、浮動小数点計算、グラフィックス処理、データパターン照合などの機能を、CPU で実行中のソフトウェアよりも効率的に実行します。GPUやFPGAを利用可能。機械学習やHPCなどの大規模なワークロードを想定。

- #### ストレージ最適化
	ストレージ最適化インスタンスは、ローカルストレージの大規模データセットに対する高いシーケンシャル読み取りおよび書き込みアクセスを必要とするワークロード用に設計されています。ストレージ最適化インスタンスは、数万 IOPS もの低レイテンシーなランダム I/O オペレーションをアプリケーションに提供するように最適化されています。インスタンスに物理的にアタッチ（付与）された高速、大容量のストレージを利用できる。データベース(SQL etc)ソフトウェアに適している。
	>- IOPS（Input/Output Operations Per Second）は、1秒あたりの入出力操作の数を表す指標です。数万IOPSとは、1秒あたりに数万回のデータの読み書きが可能であることを示しています。
	>- レイテンシーは、データが一点から別の点へ移動するのにかかる時間を指します。低レイテンシーとは、データの転送が非常に高速であることを意味します。
	>- ランダムI/Oオペレーションとは、データの読み書きがディスク上の任意の位置で行われることを指します。これは、データがディスク上の連続した位置に保存されているシーケンシャルI/Oとは対照的です

- #### HPC 最適化
	AWS で HPC ワークロードを大規模に実行するために、最高の料金パフォーマンスを提供することを目的に構築されています。HPC インスタンスは、大規模で複雑なシミュレーションや深層学習のワークロードなど、ハイパフォーマンスプロセッサのメリットを享受できるアプリケーションに最適です。GPUやFPGAを利用可能。

- **vCPU数：** インスタンスに割り当てられる仮想的なCPUの数。数字が大きいほど多くの処理を同時に行える
- **ネットワーク帯域幅：** ネットワークでのデータ転送速度

|区分|ファミリー|CPUクロック（GHz）|vCPU数|メモリ（GB）|インスタンスストレージ|ネットワーク帯域幅（Gbps）|代表的なユースケース|
|---|---|---|---|---|---|---|---|
|汎用|M5|3.1|2～96|8～384|なし|10～25|ウェブサーバー、キャッシュサーバー、コンテナホスト|
|コンピューティング最適化|C5|**3.4～3.9**|2～72|4～192|なし|10～25|バッチ処理、動画エンコーディング|
|ストレージ最適化|I3|2.3|2～72|15.25～512|**最大15.2TBのNVMe SSD**|10～25|データベース、NoSQL,DWH|
|メモリ最適化|R5|3.1|2～96|**16～768**|なし|10～25|インメモリDB、BigData|

### インスタンスサイズ

|インスタンスサイズ|vCPU|メモリ（GB）|ネットワーク帯域幅（Gbps）|オンデマンド利用料金（$/時間）|
|---|---|---|---|---|
|m5.large|2|8|最大 10|0.124|
|m5.xlarge|4|16|最大 10|0.248|
|m5.2xlarge|8|32|最大 10|0.496|
|m5.4xlarge|16|64|最大 10|0.992|
|m5.8xlarge|32|128|10|1.984|
|m5.12xlarge|48|192|10|2.976|
|m5.16xlarge|64|256|20|3.968|
|m5.24xlarge|96|384|25|5.952|

### バースト可能インスタンス
- コストが低いインスタンスでも、短時間だけ高パフォーマンスを得られる（CPUをバーストさせられる）仕組み。
- ユースケース: CPUのアイドル（待機）時間が長いアプリケーションや開発環境、一時的な用途を想定している環境、小規模なデータベースなど。  
- T2インスタンス、T3インスタンスが該当
- このバースト時は、CPUクレジットを消費する。CPUクレジット1つにつき、最大性能を1分間得られる
- CPUクレジットは、時間の経過によって回復する（回復の割合は、インスタンスサイズによって異なる）
- Unlimitedモードがあり、このモードにすると24時間で獲得可能な最大クレジット数分のCPUクレジットを前借りして使用できる
- 前借りしたCPUクレジットを超えてバーストすると、時間あたりの課金が発生する
    
    
## EC2のネットワーク構成
### ENI（Elastic Network Interface）
EC2インスタンスに付与される仮想ネットワークインターフェース。
インスタンスへの通信は、すべてENIを経由して行われます。インスタンスにはデフォルトで1つのENIがアタッチされており、必要に応じて複数のENIをアタッチできます。

## セキュリティグループ
インスタンスの通信を遮断する目的で作られる仮想ファイアウォール   
セキュリティグループはインスタンスにアタッチされているENIに関連付けられ、そのENIを介した通信のファイアウォールとして機能する。
- インバウンドトラフィック: インスタンスへ入ってくる通信を許可
- アウトバウンドトラフィック: インスタンスから出ていく通信を許可

## EC2に関する他のネットワーク機能
- 拡張ネットワーキング：インスタンスのネットワークI/O処理を専用ハードウェアにオフロードすることで、ネットワークを高速化するオプションです。対応するインスタンスタイプで追加設定をすることで利用できます。

- ネットワークACL：サブネットに属するすべてのインスタンスに対して適用されるファイアウォールで、許可と拒否のルールを定義できます。ケースや企業、サービスのポリシーによって異なりますが、たとえば、アクセス制御はセキュリティグループで行ってネットワークACLを設定したり、大枠のセキュリティはネットワークACL上で設定して細かな制御をセキュリティグループで行ったりといった風に使われます。

- 仮想プライベートネットワーク：VPCと他のローカルエリアネットワークを、VPNで接続できます。サイト間VPNと、クライアントVPNをサポートしています。AWS以外の仮想ネットワークと、セキュリティの保たれた状態で接続する場合に利用されます。

## キーペア
インスタンスにSSHで接続するため、インスタンスに対して設定できるSSHの公開鍵です。

## EC2ストレージ
[AWS公式](https://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/Storage.html)
- ### Amazon EBS
	- ストレージの性能、コスト（汎用SSD、プロビジョンIOPS SSD、スループット最適化HDDなど）を、必要に応じて選択できる
	- 他のEC2インスタンスと付け替えることができる(データを保持したままインスタンスを変更することができる)。EC2と EBSは同じアベイラビリティゾーンだと接続可能
	- 特定時点のスナップショット（バックアップ）を取得し、S3に保存したり、別のアベイラビリティゾーンにコピーできる。
	- 暗号化、モニタリングなどの機能がある
	- 冗長性があり、インスタンスを停止しても内容が消えない。
	特に理由がなければ。Amazon EBSを優先的に利用する。
- ### Amazon EFS
	- スケーラブル: EFSは「エラスティック」（Elastic）という名前が示す通り、使用するストレージ容量に応じて自動的にスケールアップまたはスケールダウンします。
	- 共有ストレージ: Network File System（NFS、プロコトル）を用いて共有されるボリュームを複数のインスタンスに同時にマウントできる。複数のインスタンス間でファイルシステムを共有する場合に使用する。
	- 耐久性と信頼性: EFSは高い耐久性と信頼性を提供します。データは複数の場所に自動的に複製されるため、ハードウェアの障害が発生してもデータが失われることはありません。
	- 大量のファイルを保存し、それらを複数の場所からアクセスする必要があるアプリケーションにとって理想的な選択肢となります(GPT)
	
- ### インスタンスストア(物理的接続)
	- 性能: アタッチできるインスタンスストアボリュームのサイズや性能は、インスタンスタイプによって決まる
	- 揮発性: インスタンスを停止 or 終了すると、保存されていたデータはすべて失われる。コンピュータのRAM（ランダムアクセスメモリ）みたいな感じ。
	- I/O性能: インスタンスストアは物理的にインスタンスに接続されているため、ネットワークを介して接続されるEBS（Elastic Block Store）よりも高速な入出力（I/O）性能を提供
	   
	OSへのマウント設定例
```console
$ sudo mkfs.ext4 -E nodiscard /dev/nvme1n1
$ sudo mkdir /mnt/ssd1
$ sudo mount -o discard /dev/nvme1n1 /mnt/ssd1
```

- ### Amazon S3
	- Amazon EC2 内から、またはウェブ上のどこからでも、いつでも必要な量だけデータを格納および取得できる

### EBS最適化オプション
EC2からEBSへのアクセスは、他サーバーとの通信やインターネットとの通信と同じネットワーク帯域を利用してアクセスされます。このため、通信量が多いシステムの場合、EBSへのアクセスに遅延が発生する可能性があります。本オプションを利用することで、以下の機能が実現します。<img width="494" alt="スクリーンショット 2023-07-02 12 20 22" src="https://github.com/rina-kondo/TIL/assets/122541296/960d6b4d-181a-45b3-a308-0d52b5ddf1ed">

